<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archive Fever · Knowledge Constellation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #06060a;
      --surface: rgba(15, 15, 25, 0.95);
      --border: rgba(255,255,255,0.06);
      --text: #e8e8e8;
      --text-muted: rgba(255,255,255,0.5);
      --text-dim: rgba(255,255,255,0.3);
      
      /* Domain colors */
      --lace: #8b5cf6;
      --pci: #ec4899;
      --cognitive: #06b6d4;
      --infra: #22c55e;
      --philosophy: #f59e0b;
      --other: #6b7280;
      
      /* Concept colors */
      --emergence: #a855f7;
      --threshold: #f472b6;
      --memory: #38bdf8;
      --reflection: #facc15;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: var(--bg);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text);
      overflow: hidden;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px 28px;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      pointer-events: none;
      background: linear-gradient(to bottom, var(--bg) 0%, transparent 100%);
    }
    
    .header-left h1 {
      font-size: 1.1rem;
      font-weight: 400;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.7);
    }
    
    .header-left p {
      font-size: 0.7rem;
      color: var(--text-dim);
      letter-spacing: 0.08em;
      margin-top: 2px;
    }
    
    .header-right {
      text-align: right;
    }
    
    .mode-toggle {
      pointer-events: auto;
      display: flex;
      gap: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 3px;
    }
    
    .mode-btn {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 0.7rem;
      font-family: inherit;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-decoration: none;
    }
    
    .mode-btn.active {
      background: rgba(255,255,255,0.08);
      color: var(--text);
    }
    
    .mode-btn:hover:not(.active) {
      color: rgba(255,255,255,0.7);
    }
    
    /* Big picture panel */
    .big-picture {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      width: 90%;
      max-width: 700px;
      max-height: 85vh;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      z-index: 200;
      backdrop-filter: blur(20px);
      overflow: hidden;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .big-picture.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .big-picture-header {
      padding: 24px 28px 20px;
      border-bottom: 1px solid var(--border);
    }
    
    .big-picture-header h2 {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .big-picture-header p {
      color: var(--text-muted);
      font-size: 0.8rem;
    }
    
    .big-picture-content {
      padding: 24px 28px;
      overflow-y: auto;
      max-height: calc(85vh - 100px);
    }
    
    .big-picture-section {
      margin-bottom: 24px;
    }
    
    .big-picture-section:last-child {
      margin-bottom: 0;
    }
    
    .big-picture-section h3 {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent);
      margin-bottom: 10px;
    }
    
    .big-picture-section p {
      font-size: 0.85rem;
      line-height: 1.7;
      color: rgba(255,255,255,0.75);
    }
    
    .big-picture-section blockquote {
      font-size: 0.9rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.6);
      font-style: italic;
      padding-left: 16px;
      border-left: 2px solid var(--accent);
      margin: 12px 0;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 150;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }
    
    /* Canvas container */
    #canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    /* Legend */
    .legend {
      position: fixed;
      bottom: 24px;
      left: 24px;
      z-index: 10;
      pointer-events: none;
    }
    
    .legend-section {
      margin-bottom: 16px;
    }
    
    .legend-title {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      margin-bottom: 8px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
      font-size: 0.65rem;
      color: var(--text-muted);
    }
    
    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    
    /* Instructions */
    .instructions {
      position: fixed;
      bottom: 24px;
      right: 24px;
      font-size: 0.65rem;
      color: var(--text-dim);
      text-align: right;
      z-index: 5;
      pointer-events: auto;
    }
    
    .surprise-btn {
      display: inline-block;
      padding: 6px 12px;
      margin-bottom: 8px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.15));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 100px;
      color: rgba(255,255,255,0.7);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .surprise-btn:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(236, 72, 153, 0.25));
      color: #fff;
      transform: translateY(-1px);
    }
    
    @keyframes subtlePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
      50% { box-shadow: 0 0 12px 2px rgba(139, 92, 246, 0.3); }
    }
    
    .surprise-btn {
      animation: subtlePulse 3s ease-in-out infinite;
    }
    
    .surprise-btn:hover {
      animation: none;
    }
    
    /* Detail panel */
    .detail-panel {
      position: fixed;
      top: 80px;
      right: 24px;
      width: 380px;
      max-height: calc(100vh - 104px);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      z-index: 50;
      backdrop-filter: blur(20px);
      transform: translateX(420px);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .detail-panel.visible {
      transform: translateX(0);
    }
    
    .panel-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid var(--border);
      position: relative;
    }
    
    .panel-header h2 {
      font-size: 1rem;
      font-weight: 500;
      padding-right: 32px;
      line-height: 1.4;
    }
    
    .panel-category {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      margin-top: 6px;
    }
    
    .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 26px;
      height: 26px;
      border: none;
      background: rgba(255,255,255,0.04);
      border-radius: 50%;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: rgba(255,255,255,0.08);
      color: var(--text);
    }
    
    .panel-content {
      padding: 20px 24px;
      overflow-y: auto;
      flex: 1;
    }
    
    .panel-section {
      margin-bottom: 20px;
    }
    
    .panel-section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      margin-bottom: 8px;
    }
    
    .panel-description {
      font-size: 0.82rem;
      line-height: 1.65;
      color: rgba(255,255,255,0.75);
    }
    
    .panel-quote {
      font-size: 0.8rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.6);
      font-style: italic;
      padding-left: 12px;
      border-left: 2px solid var(--border);
    }
    
    .concept-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .concept-tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      font-size: 0.65rem;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 100px;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .concept-tag:hover {
      background: rgba(255,255,255,0.08);
      color: var(--text);
    }
    
    .connections-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .connection-item {
      font-size: 0.78rem;
      color: var(--text-muted);
      padding: 8px 12px;
      background: rgba(255,255,255,0.02);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .connection-item:hover {
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }
    
    .connection-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    
    .read-full-btn {
      display: block;
      text-align: center;
      padding: 12px 20px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.1));
      border: 1px solid rgba(139, 92, 246, 0.25);
      border-radius: 8px;
      color: var(--accent);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .read-full-btn:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(236, 72, 153, 0.15));
      transform: translateY(-1px);
    }
    
    /* Concept panel */
    .concept-panel {
      position: fixed;
      top: 80px;
      left: 24px;
      width: 320px;
      max-height: calc(100vh - 200px);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      z-index: 50;
      backdrop-filter: blur(20px);
      transform: translateX(-360px);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      overflow: hidden;
    }
    
    .concept-panel.visible {
      transform: translateX(0);
    }
    
    .concept-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .concept-header h3 {
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .concept-content {
      padding: 16px 20px;
      overflow-y: auto;
      max-height: 400px;
    }
    
    .concept-description {
      font-size: 0.8rem;
      line-height: 1.6;
      color: rgba(255,255,255,0.7);
      margin-bottom: 16px;
    }
    
    .concept-essays {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .concept-essay-item {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 8px 10px;
      background: rgba(255,255,255,0.02);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .concept-essay-item:hover {
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }
    
    /* Search */
    .search-container {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 60;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .search-container.visible {
      opacity: 1;
      pointer-events: auto;
    }
    
    .search-input {
      width: 400px;
      padding: 12px 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
    }
    
    .search-input::placeholder {
      color: var(--text-dim);
    }
    
    .search-input:focus {
      border-color: rgba(255,255,255,0.15);
    }
    
    /* SVG styles */
    .link {
      stroke: rgba(255,255,255,0.06);
      stroke-width: 1;
      transition: all 0.3s;
    }
    
    .link.highlighted {
      stroke: rgba(255,255,255,0.35);
      stroke-width: 1.5;
    }
    
    .link.concept-highlight {
      stroke-width: 2;
    }
    
    .node {
      cursor: pointer;
    }
    
    .node circle {
      transition: all 0.3s ease;
    }
    
    .node:hover circle {
      filter: brightness(1.3);
    }
    
    .node-label {
      font-size: 9px;
      fill: var(--text-muted);
      pointer-events: none;
      text-anchor: middle;
      font-family: 'Inter', sans-serif;
    }
    
    .glow {
      filter: url(#glow);
    }
    
    /* Entrance animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .node {
      animation: fadeIn 0.6s ease-out;
      animation-fill-mode: backwards;
    }
    
    .node:nth-child(1) { animation-delay: 0.05s; }
    .node:nth-child(2) { animation-delay: 0.1s; }
    .node:nth-child(3) { animation-delay: 0.15s; }
    .node:nth-child(4) { animation-delay: 0.2s; }
    .node:nth-child(5) { animation-delay: 0.25s; }
    .node:nth-child(6) { animation-delay: 0.3s; }
    .node:nth-child(7) { animation-delay: 0.35s; }
    .node:nth-child(8) { animation-delay: 0.4s; }
    .node:nth-child(9) { animation-delay: 0.45s; }
    .node:nth-child(10) { animation-delay: 0.5s; }
    .node:nth-child(n+11) { animation-delay: 0.55s; }
    
    /* Concept nodes (when in concept mode) */
    .concept-node {
      cursor: pointer;
    }
    
    .concept-node text {
      font-size: 11px;
      fill: var(--text);
      font-weight: 500;
      pointer-events: none;
    }
    
    /* Keyboard hints */
    kbd {
      display: inline-block;
      padding: 2px 6px;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text-muted);
    }
    
    /* Responsive */
    @media (max-width: 900px) {
      .detail-panel {
        width: calc(100vw - 48px);
        right: 24px;
      }
      
      .concept-panel {
        width: calc(100vw - 48px);
        left: 24px;
      }
      
      .legend {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left">
      <h1>Archive Fever</h1>
      <p>22 essays · 65 connections · emergent ontology</p>
    </div>
    <div class="header-right">
      <div class="mode-toggle">
        <button class="mode-btn" onclick="showBigPicture()">Overview</button>
        <a href="paths.html" class="mode-btn">Paths</a>
      </div>
    </div>
  </div>
  
  <div class="legend">
    <div class="legend-section">
      <div class="legend-title">Domains</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--lace);"></div>LACE · Knowledge Management</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--pci);"></div>PCI · Psyche-Computer Interface</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--cognitive);"></div>Cognitive Architecture</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--infra);"></div>Infrastructure & Design</div>
      <div class="legend-item"><div class="legend-dot" style="background: var(--philosophy);"></div>Philosophy & Method</div>
    </div>
  </div>
  
  <div class="instructions">
    <span class="surprise-btn" onclick="surpriseMe()">✨ surprise me</span><br>
    drag · scroll · <kbd>/</kbd> search · <kbd>esc</kbd> close
  </div>
  
  <div id="detail-panel" class="detail-panel">
    <div class="panel-header">
      <h2 id="panel-title"></h2>
      <div id="panel-category" class="panel-category"></div>
      <button class="close-btn" onclick="closePanel()">×</button>
    </div>
    <div class="panel-content">
      <div class="panel-section">
        <div class="section-title">Core Insight</div>
        <div id="panel-description" class="panel-description"></div>
      </div>
      <div class="panel-section">
        <div class="section-title">Key Quote</div>
        <div id="panel-quote" class="panel-quote"></div>
      </div>
      <div class="panel-section">
        <div class="section-title">Concepts</div>
        <div id="panel-concepts" class="concept-tags"></div>
      </div>
      <div class="panel-section">
        <div class="section-title">Connected Essays</div>
        <div id="panel-connections" class="connections-list"></div>
      </div>
      <div class="panel-section">
        <a id="panel-link" href="#" target="_blank" class="read-full-btn">Read Full Essay →</a>
      </div>
    </div>
  </div>
  
  <div id="concept-panel" class="concept-panel">
    <div class="concept-header">
      <h3 id="concept-title"></h3>
      <button class="close-btn" onclick="closeConceptPanel()">×</button>
    </div>
    <div class="concept-content">
      <div id="concept-description" class="concept-description"></div>
      <div class="section-title" style="margin-bottom: 8px;">Essays exploring this concept</div>
      <div id="concept-essays" class="concept-essays"></div>
    </div>
  </div>
  
  <div class="search-container" id="search-container">
    <input type="text" class="search-input" id="search-input" placeholder="Search essays and concepts...">
  </div>
  
  <div class="overlay" id="overlay" onclick="hideBigPicture()"></div>
  
  <div class="big-picture" id="big-picture">
    <div class="big-picture-header">
      <h2>Archive Fever: The Big Picture</h2>
      <p>22 essays on emergent ontology, psyche-computer interfaces, and threshold structures</p>
    </div>
    <div class="big-picture-content">
      <div class="big-picture-section">
        <h3>Core Philosophy</h3>
        <p>These essays circle around a central conviction: <strong>knowledge structures should emerge from use rather than being imposed upfront</strong>. Categories, relationships, and hierarchies should crystallize through observation and reflection, not design.</p>
        <blockquote>"The paradox at the heart of knowledge systems: you need structure to make information useful, but the structure you need keeps changing as you learn."</blockquote>
      </div>
      
      <div class="big-picture-section">
        <h3>Key Projects</h3>
        <p><strong>LACE</strong> — A knowledge management system where ontology emerges through 4 layers: fragments → propositions → patterns → projects. Event-sourced, so all history is preserved.<br><br>
        <strong>PCI</strong> — Psyche-Computer Interface. Systems that treat language as a window to inner states. The "mirror that listens."<br><br>
        <strong>Tristero</strong> — Event-sourced knowledge where reflection governs ontology evolution. Propose → Critique → Execute.</p>
      </div>
      
      <div class="big-picture-section">
        <h3>Threshold Structures</h3>
        <p>A recurring concept informed by Circassian/Ottoman displacement history: systems that enable transformation without destruction. Liminal spaces—like the historical caravanserai—where different maps can coexist without forcing premature synthesis.</p>
        <blockquote>"The best AI interface is a threshold—a liminal space where transformation becomes possible."</blockquote>
      </div>
      
      <div class="big-picture-section">
        <h3>Intellectual Threads</h3>
        <p>• <strong>Warburg's Mnemosyne Atlas</strong> — Meaning through constellation, not hierarchy. The iconology of intervals.<br>
        • <strong>Simondon's individuation</strong> — Individuals consist in relations. Context as membrane of mutual becoming.<br>
        • <strong>The Bitter Lesson</strong> — Build meta-methods that find complexity, not the complexity itself.<br>
        • <strong>Visible Cognition</strong> — Process as artifact. Streaming text creates presence and the sensation of witnessing thought unfold.</p>
      </div>
      
      <div class="big-picture-section">
        <h3>Navigate</h3>
        <p>Click any essay node to explore its connections and key insights. Press <kbd>/</kbd> to search. Or explore the <a href="paths.html" style="color: var(--accent);">curated reading paths</a>.</p>
      </div>
    </div>
  </div>
  
  <div id="canvas-container"></div>
  
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // ============================================
    // DEEP ESSAY DATA
    // ============================================
    
    const essays = [
      {
        id: "tristero",
        title: "Tristero: Event-Sourced Knowledge",
        category: "LACE",
        description: "Knowledge systems should treat organizational structure as emergent, provisional, and learnable. Event sourcing provides the infrastructure—rebuild projections when understanding evolves without losing underlying observations.",
        quote: "The paradox at the heart of knowledge systems: you need structure to make information useful, but the structure you need keeps changing as you learn.",
        concepts: ["emergent ontology", "event sourcing", "reflection", "threshold structures", "bitter lesson"],
        connections: ["bidirectional-context", "advanced-rag", "infrastructure-tradeoffs"]
      },
      {
        id: "bidirectional-context",
        title: "Bidirectional Context",
        category: "Philosophy",
        description: "Context as a membrane of mutual becoming—both human and AI transformed through encounter. Simondon's insight: individuals consist in relations, and relation has the status of being.",
        quote: "The context window isn't where thinking happens; it's part of what thinking is.",
        concepts: ["mutual transformation", "Simondon", "extended mind", "threshold structures", "emergence"],
        connections: ["tristero", "visible-cognition", "psyche-computer-interface"]
      },
      {
        id: "visible-cognition",
        title: "Visible Cognition",
        category: "Philosophy",
        description: "The emerging aesthetic of reasoning-forward interfaces: literary traditions that foreground thought's movement, philosophical forms that perform inquiry, computational systems where the trace of reasoning becomes the primary artifact.",
        quote: "Text that appears word-by-word activates fundamentally different cognitive and affective registers than static text—creating presence, anticipation, and the sensation of witnessing thought unfold.",
        concepts: ["process", "streaming", "phenomenology", "closure", "Warburg"],
        connections: ["bidirectional-context", "reasoning-traces-psyche", "ontological-composition"]
      },
      {
        id: "ontological-composition",
        title: "Ontological Composition",
        category: "Philosophy",
        description: "Using organizational structures discovered in one domain to illuminate structure in another. Warburg's Mnemosyne Atlas as model: meaning emerges from the spaces between, not individual images.",
        quote: "The most promising path forward would combine schema abstraction mechanisms from analogical reasoning with ontology design patterns as transferable structural primitives.",
        concepts: ["Warburg", "transfer", "pattern", "anarchive", "schema"],
        connections: ["visible-cognition", "tristero", "psyche-polis"]
      },
      {
        id: "psyche-computer-interface",
        title: "Psyche-Computer Interface",
        category: "PCI",
        description: "Systems that treat words and behaviors as reflection of inner world, using them to adapt and respond insightfully. The mirror that listens—language as window to the unconscious.",
        quote: "A PCI is less about machines reading our minds, and more about giving us new mirrors to read our own minds more clearly.",
        concepts: ["psyche", "reflection", "language", "unconscious", "mutual transformation"],
        connections: ["bidirectional-context", "psyche-polis", "reasoning-traces-psyche"]
      },
      {
        id: "psyche-polis",
        title: "Psyche-Polis",
        category: "PCI",
        description: "Transforming journal entries into procedural city formations. Freud's impossible Rome—psychic strata coexisting simultaneously—combined with ECS architecture and structured LLM interpretation.",
        quote: "The city must mirror the soul's organization, not merely illustrate its contents.",
        concepts: ["city", "memory palace", "emergence", "ECS", "Freud"],
        connections: ["psyche-computer-interface", "artificial-dream-systems", "game-engines"]
      },
      {
        id: "reasoning-traces-psyche",
        title: "Reasoning Traces & Psyche",
        category: "PCI",
        description: "Using chain-of-thought reasoning traces as psychological material. Analyst agents interpret traces to extract implicit user models, patterns, and affective inferences.",
        quote: "Traces represent something like an 'unconscious' layer—cognition that shapes behavior without direct expression.",
        concepts: ["reasoning traces", "analyst", "psyche", "implicit", "emergence"],
        connections: ["psyche-computer-interface", "visible-cognition", "triple-network-model"]
      },
      {
        id: "small-model-swarm",
        title: "Small Model Swarm",
        category: "PCI",
        description: "Production stack for psychographic graph modeling using LangGraph + Graphiti + specialized models. Orchestrated intelligence through coordinated specialists.",
        quote: "Specialized small models can outperform generalist frontier models on structured extraction tasks.",
        concepts: ["swarm", "orchestration", "specialization", "graph", "production"],
        connections: ["psyche-computer-interface", "advanced-rag", "infrastructure-tradeoffs"]
      },
      {
        id: "triple-network-model",
        title: "Triple Network Model",
        category: "Cognitive",
        description: "Menon's DMN/FPN/SN framework: Default Mode for self-reference, Frontoparietal for task execution, Salience Network as the critical switching mechanism between them.",
        quote: "The anterior insula acts as a 'causal hub,' generating control signals that simultaneously activate the FPN while suppressing the DMN.",
        concepts: ["networks", "attention", "switching", "DMN", "salience"],
        connections: ["reasoning-traces-psyche", "artificial-dream-systems", "psyche-computer-interface"]
      },
      {
        id: "artificial-dream-systems",
        title: "Artificial Dream Systems",
        category: "Cognitive",
        description: "AI dreaming for consolidation, creativity, and continual learning. Mechanisms that recombine and generate experiences offline to improve learning and cognition.",
        quote: "Creative dreaming can bootstrap abstraction. The dreams serve as a sandbox for exploring concept space—making surprising connections that weren't explicit in the input data.",
        concepts: ["dreams", "consolidation", "creativity", "memory", "emergence"],
        connections: ["psyche-polis", "triple-network-model", "semantic-retrieval-memory"]
      },
      {
        id: "memory-architectures",
        title: "Memory Architectures",
        category: "Cognitive",
        description: "Comparing ChatGPT vs Claude vs Gemini memory implementations. How different systems approach persistence, recall, and user modeling.",
        quote: "Memory systems determine not just what is remembered, but how the system relates to its user over time.",
        concepts: ["memory", "persistence", "user modeling", "architecture", "comparison"],
        connections: ["bidirectional-context", "semantic-retrieval-memory", "advanced-rag"]
      },
      {
        id: "advanced-rag",
        title: "Advanced RAG Architectures",
        category: "LACE",
        description: "Hypergraph memory, Graph-O1, MegaRAG patterns for emergent ontology. Key innovations: hyperedge merging for pattern crystallization, multi-criteria RL rewards for relational density.",
        quote: "Typed relations become hyperedge attributes. Contradiction detection leverages constraint satisfaction over hyperedges.",
        concepts: ["RAG", "hypergraph", "crystallization", "emergence", "knowledge graph"],
        connections: ["tristero", "dynamic-knowledge-graphs", "semantic-retrieval-memory"]
      },
      {
        id: "dynamic-knowledge-graphs",
        title: "Dynamic Knowledge Graphs",
        category: "LACE",
        description: "Living knowledge bases with small model + frontier LLM orchestration. Graphs that evolve through use rather than upfront design.",
        quote: "Categories, relationships, hierarchies should arise from use patterns rather than upfront design.",
        concepts: ["knowledge graph", "emergence", "orchestration", "living systems", "evolution"],
        connections: ["tristero", "advanced-rag", "llm-kg-benchmarks"]
      },
      {
        id: "semantic-retrieval-memory",
        title: "Semantic Retrieval & Memory",
        category: "LACE",
        description: "Dynamic threshold calibration, forgetting mechanisms, context management. How systems learn what to remember and what to let go.",
        quote: "Forgetting is not failure—it's curation. Systems must learn what matters enough to preserve.",
        concepts: ["memory", "forgetting", "retrieval", "thresholds", "context"],
        connections: ["advanced-rag", "artificial-dream-systems", "memory-architectures"]
      },
      {
        id: "llm-kg-benchmarks",
        title: "LLM-KG Benchmarks",
        category: "LACE",
        description: "Fine-tuned 7B models outperform GPT-4 on knowledge graph completion. Evidence that specialized small models beat generalists on structured tasks.",
        quote: "The bitter lesson meets specialization: sometimes craft beats scale when the task is well-defined.",
        concepts: ["benchmarks", "specialization", "knowledge graph", "fine-tuning", "bitter lesson"],
        connections: ["dynamic-knowledge-graphs", "small-model-swarm", "infrastructure-tradeoffs"]
      },
      {
        id: "infrastructure-tradeoffs",
        title: "Infrastructure Tradeoffs",
        category: "Infrastructure",
        description: "The Bitter Lesson applied to agents: light scaffolding beats heavy validation. Build meta-methods, not complexity. Quantitative metrics cannot capture ontological quality.",
        quote: "Build in only the meta-methods that can find and capture complexity, not the complexity itself.",
        concepts: ["bitter lesson", "scaffolding", "validation", "meta-methods", "emergence"],
        connections: ["tristero", "deep-research-agents", "vibe-coding-infrastructure"]
      },
      {
        id: "vibe-coding-infrastructure",
        title: "Vibe Coding Infrastructure",
        category: "Infrastructure",
        description: "Complete stack: Supabase + Vercel + Inngest + shadcn/ui. The aesthetic of modern development infrastructure.",
        quote: "Infrastructure should be invisible until you need it, then obvious when you do.",
        concepts: ["infrastructure", "stack", "aesthetic", "tooling", "modern"],
        connections: ["infrastructure-tradeoffs", "deep-research-agents", "generative-ai-design"]
      },
      {
        id: "deep-research-agents",
        title: "Deep Research Agents",
        category: "Infrastructure",
        description: "Technical guide for LangGraph, Tavily, and plan-execute patterns. Building agents that can actually research.",
        quote: "Research is not retrieval—it's the iterative process of refining questions through what you discover.",
        concepts: ["agents", "research", "planning", "execution", "iteration"],
        connections: ["infrastructure-tradeoffs", "vibe-coding-infrastructure", "small-model-swarm"]
      },
      {
        id: "generative-ai-design",
        title: "Generative AI Design",
        category: "Infrastructure",
        description: "UX patterns for AI: onboarding, memory, persona persistence, failure recovery. The human side of AI systems.",
        quote: "The best AI interface is a threshold—a liminal space where transformation becomes possible.",
        concepts: ["design", "UX", "persona", "threshold structures", "failure"],
        connections: ["bidirectional-context", "vibe-coding-infrastructure", "psyche-computer-interface"]
      },
      {
        id: "alternative-data-signals",
        title: "Alternative Data Signals",
        category: "Philosophy",
        description: "OSINT and proxy signals for sense-making. Finding truth in indirect evidence when direct observation is impossible.",
        quote: "The most valuable signals are often the ones no one is optimizing for.",
        concepts: ["OSINT", "signals", "sense-making", "proxy", "evidence"],
        connections: ["ontological-composition", "dynamic-knowledge-graphs", "reasoning-traces-psyche"]
      },
      {
        id: "notebooklm-analysis",
        title: "NotebookLM Analysis",
        category: "Other",
        description: "Multi-source synthesis and RAG pipeline analysis. Understanding Google's approach to document intelligence.",
        quote: "Synthesis is not aggregation—it's the creation of novel understanding from multiple sources.",
        concepts: ["synthesis", "RAG", "documents", "analysis", "Google"],
        connections: ["advanced-rag", "memory-architectures", "deep-research-agents"]
      },
      {
        id: "game-engines",
        title: "Game Engines & Simulation",
        category: "Other",
        description: "ECS architecture and engines as world models. Simulation as epistemology—understanding through building.",
        quote: "The engine is not a tool for making games—it's a way of thinking about worlds.",
        concepts: ["ECS", "simulation", "world models", "games", "architecture"],
        connections: ["psyche-polis", "artificial-dream-systems", "infrastructure-tradeoffs"]
      }
    ];
    
    // ============================================
    // KEY CONCEPTS (for concept mode)
    // ============================================
    
    const keyConcepts = [
      {
        id: "emergent-ontology",
        name: "Emergent Ontology",
        description: "Categories, types, and relationships should arise from use patterns rather than upfront design. Structure crystallizes through observation, not imposition.",
        color: "var(--emergence)",
        essays: ["tristero", "dynamic-knowledge-graphs", "advanced-rag", "infrastructure-tradeoffs"]
      },
      {
        id: "threshold-structures",
        name: "Threshold Structures",
        description: "Systems that enable transformation without destruction. Liminal spaces where change becomes possible while preserving what matters.",
        color: "var(--threshold)",
        essays: ["tristero", "bidirectional-context", "generative-ai-design", "psyche-polis"]
      },
      {
        id: "mutual-transformation",
        name: "Mutual Transformation",
        description: "Both parties changed through encounter. Context as membrane of becoming, not container. Simondon's relational ontology.",
        color: "var(--emergence)",
        essays: ["bidirectional-context", "psyche-computer-interface", "visible-cognition"]
      },
      {
        id: "bitter-lesson",
        name: "The Bitter Lesson",
        description: "General methods leveraging computation beat hand-crafted knowledge. Build meta-methods that can find complexity, not the complexity itself.",
        color: "var(--infra)",
        essays: ["infrastructure-tradeoffs", "tristero", "llm-kg-benchmarks"]
      },
      {
        id: "reflection-process",
        name: "Reflection as Process",
        description: "Governed ontology evolution through propose → critique → execute. The system that observes itself and learns from the observation.",
        color: "var(--reflection)",
        essays: ["tristero", "reasoning-traces-psyche", "psyche-computer-interface"]
      },
      {
        id: "memory-consolidation",
        name: "Memory & Consolidation",
        description: "What to remember, what to forget, how to transform. Dreams, replay, and the architecture of persistence.",
        color: "var(--memory)",
        essays: ["artificial-dream-systems", "semantic-retrieval-memory", "memory-architectures", "psyche-polis"]
      },
      {
        id: "visible-process",
        name: "Visible Process",
        description: "The trace of reasoning as primary artifact. Streaming text phenomenology. Process made observable and meaningful.",
        color: "var(--philosophy)",
        essays: ["visible-cognition", "reasoning-traces-psyche", "bidirectional-context"]
      },
      {
        id: "warburg-method",
        name: "Warburgian Method",
        description: "Meaning through juxtaposition. The iconology of intervals. Constellation thinking over hierarchical taxonomy.",
        color: "var(--philosophy)",
        essays: ["ontological-composition", "visible-cognition", "psyche-polis"]
      }
    ];
    
    // ============================================
    // CATEGORY COLORS
    // ============================================
    
    const categoryColors = {
      "LACE": "var(--lace)",
      "PCI": "var(--pci)",
      "Cognitive": "var(--cognitive)",
      "Infrastructure": "var(--infra)",
      "Philosophy": "var(--philosophy)",
      "Other": "var(--other)"
    };
    
    // ============================================
    // BUILD LINKS FROM CONNECTIONS
    // ============================================
    
    function buildLinks(essays) {
      const links = [];
      const seen = new Set();
      
      essays.forEach(essay => {
        essay.connections.forEach(targetId => {
          const key = [essay.id, targetId].sort().join('--');
          if (!seen.has(key)) {
            seen.add(key);
            const target = essays.find(e => e.id === targetId);
            if (target) {
              // Find shared concepts
              const sharedConcepts = essay.concepts.filter(c => 
                target.concepts.includes(c)
              );
              links.push({
                source: essay.id,
                target: targetId,
                strength: 0.5 + sharedConcepts.length * 0.2,
                sharedConcepts
              });
            }
          }
        });
      });
      
      return links;
    }
    
    const links = buildLinks(essays);
    
    // ============================================
    // SVG SETUP
    // ============================================
    
    const container = document.getElementById('canvas-container');
    const width = window.innerWidth;
    const height = window.innerHeight;
    
    const svg = d3.select(container)
      .append("svg")
      .attr("width", width)
      .attr("height", height);
    
    // Glow filter
    const defs = svg.append("defs");
    const filter = defs.append("filter")
      .attr("id", "glow")
      .attr("x", "-100%").attr("y", "-100%")
      .attr("width", "300%").attr("height", "300%");
    
    filter.append("feGaussianBlur")
      .attr("stdDeviation", "3")
      .attr("result", "coloredBlur");
    
    const feMerge = filter.append("feMerge");
    feMerge.append("feMergeNode").attr("in", "coloredBlur");
    feMerge.append("feMergeNode").attr("in", "SourceGraphic");
    
    // Starfield
    const starfield = svg.append("g").attr("class", "starfield");
    for (let i = 0; i < 150; i++) {
      starfield.append("circle")
        .attr("cx", Math.random() * width)
        .attr("cy", Math.random() * height)
        .attr("r", Math.random() * 1)
        .attr("fill", `rgba(255,255,255,${Math.random() * 0.2 + 0.05})`);
    }
    
    // Main group with zoom
    const g = svg.append("g");
    
    const zoom = d3.zoom()
      .scaleExtent([0.3, 3])
      .on("zoom", (event) => {
        g.attr("transform", event.transform);
      });
    
    svg.call(zoom);
    
    // ============================================
    // FORCE SIMULATION
    // ============================================
    
    const simulation = d3.forceSimulation(essays)
      .force("link", d3.forceLink(links).id(d => d.id).distance(140).strength(d => d.strength * 0.15))
      .force("charge", d3.forceManyBody().strength(-400))
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(55));
    
    // Links
    const link = g.append("g")
      .selectAll("line")
      .data(links)
      .join("line")
      .attr("class", "link")
      .attr("stroke-opacity", d => Math.min(d.strength * 0.4, 0.5));
    
    // Nodes
    const node = g.append("g")
      .selectAll("g")
      .data(essays)
      .join("g")
      .attr("class", "node")
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));
    
    // Outer glow
    node.append("circle")
      .attr("r", 16)
      .attr("fill", d => categoryColors[d.category])
      .attr("opacity", 0.15)
      .attr("class", "glow");
    
    // Main circle
    node.append("circle")
      .attr("r", 10)
      .attr("fill", d => categoryColors[d.category])
      .attr("opacity", 0.9);
    
    // Inner core
    node.append("circle")
      .attr("r", 3)
      .attr("fill", "#fff")
      .attr("opacity", 0.7);
    
    // Labels
    node.append("text")
      .attr("class", "node-label")
      .attr("dy", 26)
      .text(d => d.title.length > 22 ? d.title.slice(0, 20) + "…" : d.title);
    
    // ============================================
    // INTERACTIONS
    // ============================================
    
    let selectedEssay = null;
    let selectedConcept = null;
    
    node.on("click", (event, d) => {
      event.stopPropagation();
      selectedEssay = d;
      showPanel(d);
      highlightConnections(d);
    });
    
    node.on("mouseenter", (event, d) => {
      if (!selectedEssay) {
        highlightConnections(d);
      }
    });
    
    node.on("mouseleave", () => {
      if (!selectedEssay) {
        resetHighlights();
      }
    });
    
    svg.on("click", () => {
      closePanel();
      closeConceptPanel();
      selectedEssay = null;
      selectedConcept = null;
      resetHighlights();
    });
    
    function highlightConnections(d) {
      const connected = new Set();
      links.forEach(l => {
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        if (sourceId === d.id) connected.add(targetId);
        if (targetId === d.id) connected.add(sourceId);
      });
      
      link.classed("highlighted", l => {
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        return sourceId === d.id || targetId === d.id;
      });
      
      node.style("opacity", n => n.id === d.id || connected.has(n.id) ? 1 : 0.25);
    }
    
    function highlightConcept(conceptId) {
      const concept = keyConcepts.find(c => c.id === conceptId);
      if (!concept) return;
      
      const essaySet = new Set(concept.essays);
      
      node.style("opacity", n => essaySet.has(n.id) ? 1 : 0.15);
      
      link.classed("highlighted", l => {
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        return essaySet.has(sourceId) && essaySet.has(targetId);
      });
      
      link.style("stroke", l => {
        const sourceId = typeof l.source === 'object' ? l.source.id : l.source;
        const targetId = typeof l.target === 'object' ? l.target.id : l.target;
        if (essaySet.has(sourceId) && essaySet.has(targetId)) {
          return concept.color;
        }
        return null;
      });
    }
    
    function resetHighlights() {
      link.classed("highlighted", false);
      link.style("stroke", null);
      node.style("opacity", 1);
    }
    
    // ============================================
    // PANELS
    // ============================================
    
    function showPanel(d) {
      const panel = document.getElementById('detail-panel');
      document.getElementById('panel-title').textContent = d.title;
      document.getElementById('panel-category').textContent = d.category;
      document.getElementById('panel-category').style.color = categoryColors[d.category];
      document.getElementById('panel-description').textContent = d.description;
      document.getElementById('panel-quote').textContent = d.quote;
      document.getElementById('panel-link').href = `https://fcdagdelen.github.io/archive-fever/${d.id}`;
      
      // Concepts
      const conceptsDiv = document.getElementById('panel-concepts');
      conceptsDiv.innerHTML = d.concepts.map(c => {
        const keyConcept = keyConcepts.find(kc => kc.essays.includes(d.id) && kc.name.toLowerCase().includes(c.toLowerCase()));
        const color = keyConcept ? keyConcept.color : 'var(--text-muted)';
        return `<span class="concept-tag" onclick="showConceptFromTag('${c}')" style="border-color: ${color}40;">${c}</span>`;
      }).join('');
      
      // Connections
      const connectionsDiv = document.getElementById('panel-connections');
      const connectedEssays = d.connections
        .map(id => essays.find(e => e.id === id))
        .filter(Boolean);
      
      connectionsDiv.innerHTML = connectedEssays.map(e => `
        <div class="connection-item" onclick="focusNode('${e.id}')">
          <div class="connection-dot" style="background: ${categoryColors[e.category]};"></div>
          ${e.title}
        </div>
      `).join('');
      
      panel.classList.add('visible');
      closeConceptPanel();
    }
    
    function showConceptPanel(concept) {
      const panel = document.getElementById('concept-panel');
      document.getElementById('concept-title').textContent = concept.name;
      document.getElementById('concept-title').style.color = concept.color;
      document.getElementById('concept-description').textContent = concept.description;
      
      const essaysDiv = document.getElementById('concept-essays');
      essaysDiv.innerHTML = concept.essays.map(id => {
        const essay = essays.find(e => e.id === id);
        if (!essay) return '';
        return `<div class="concept-essay-item" onclick="focusNode('${id}')">${essay.title}</div>`;
      }).join('');
      
      panel.classList.add('visible');
      highlightConcept(concept.id);
      selectedConcept = concept;
    }
    
    window.showConceptFromTag = function(tag) {
      const concept = keyConcepts.find(c => 
        c.name.toLowerCase().includes(tag.toLowerCase()) ||
        tag.toLowerCase().includes(c.name.toLowerCase().split(' ')[0])
      );
      if (concept) {
        showConceptPanel(concept);
      }
    };
    
    window.closePanel = function() {
      document.getElementById('detail-panel').classList.remove('visible');
      selectedEssay = null;
      if (!selectedConcept) resetHighlights();
    };
    
    window.closeConceptPanel = function() {
      document.getElementById('concept-panel').classList.remove('visible');
      selectedConcept = null;
      if (!selectedEssay) resetHighlights();
    };
    
    window.focusNode = function(id) {
      const d = essays.find(e => e.id === id);
      if (d) {
        selectedEssay = d;
        showPanel(d);
        highlightConnections(d);
        
        // Pan to node
        const transform = d3.zoomTransform(svg.node());
        svg.transition().duration(600).call(
          zoom.transform,
          d3.zoomIdentity
            .translate(width / 2, height / 2)
            .scale(transform.k)
            .translate(-d.x, -d.y)
        );
      }
    };
    
    // ============================================
    // BIG PICTURE OVERLAY
    // ============================================
    
    window.showBigPicture = function() {
      document.getElementById('overlay').classList.add('visible');
      document.getElementById('big-picture').classList.add('visible');
    };
    
    window.hideBigPicture = function() {
      document.getElementById('overlay').classList.remove('visible');
      document.getElementById('big-picture').classList.remove('visible');
    };
    
    // ============================================
    // SURPRISE ME - RANDOM EXPLORATION
    // ============================================
    
    window.surpriseMe = function() {
      const randomEssay = essays[Math.floor(Math.random() * essays.length)];
      focusNode(randomEssay.id);
    };
    
    // ============================================
    // SEARCH
    // ============================================
    
    document.addEventListener('keydown', (e) => {
      if (e.key === '/' && !e.ctrlKey && !e.metaKey) {
        e.preventDefault();
        document.getElementById('search-container').classList.add('visible');
        document.getElementById('search-input').focus();
      }
      if (e.key === 'Escape') {
        document.getElementById('search-container').classList.remove('visible');
        hideBigPicture();
        closePanel();
        closeConceptPanel();
        selectedEssay = null;
        selectedConcept = null;
        resetHighlights();
      }
    });
    
    document.getElementById('search-input').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      if (!query) {
        resetHighlights();
        return;
      }
      
      const matches = essays.filter(essay => 
        essay.title.toLowerCase().includes(query) ||
        essay.concepts.some(c => c.toLowerCase().includes(query)) ||
        essay.description.toLowerCase().includes(query)
      );
      
      const matchIds = new Set(matches.map(m => m.id));
      node.style("opacity", n => matchIds.has(n.id) ? 1 : 0.15);
    });
    
    document.getElementById('search-input').addEventListener('blur', () => {
      setTimeout(() => {
        document.getElementById('search-container').classList.remove('visible');
        if (!selectedEssay && !selectedConcept) resetHighlights();
      }, 200);
    });
    
    // ============================================
    // SIMULATION TICK
    // ============================================
    
    simulation.on("tick", () => {
      link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);
      
      node.attr("transform", d => `translate(${d.x},${d.y})`);
    });
    
    // Drag functions
    function dragstarted(event) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      event.subject.fx = event.subject.x;
      event.subject.fy = event.subject.y;
    }
    
    function dragged(event) {
      event.subject.fx = event.x;
      event.subject.fy = event.y;
    }
    
    function dragended(event) {
      if (!event.active) simulation.alphaTarget(0);
      event.subject.fx = null;
      event.subject.fy = null;
    }
    
    // Resize
    window.addEventListener('resize', () => {
      const newWidth = window.innerWidth;
      const newHeight = window.innerHeight;
      svg.attr("width", newWidth).attr("height", newHeight);
      simulation.force("center", d3.forceCenter(newWidth / 2, newHeight / 2));
      simulation.alpha(0.3).restart();
    });
    
    // Initial view
    svg.call(zoom.transform, d3.zoomIdentity.translate(0, 0).scale(0.9));
    
    // Show overview on first visit
    if (!localStorage.getItem('archive-fever-visited')) {
      setTimeout(() => {
        showBigPicture();
        localStorage.setItem('archive-fever-visited', 'true');
      }, 1000);
    }
  </script>
</body>
</html>
